<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VOCAB / PHRASE BLAST v3.0</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<style>
 html,body{margin:0;height:100%;font-family:"Segoe UI",sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;justify-content:center;align-items:center}
 #game{max-width:540px;width:94vw;text-align:center}
 h1{margin:0 0 6px;font-size:2rem;color:#ffeb3b;text-shadow:0 0 8px #ff0}
 #jp{font-size:1.4rem;margin:14px 0 18px;min-height:2.6rem}
 .opt{width:100%;padding:12px 0;margin:6px 0;font-size:1.1rem;border:none;border-radius:10px;background:#434343;color:#fff;transition:transform .15s}
 .opt:active{transform:scale(.96)}
 .correct{background:#00c853!important}
 .wrong{background:#d50000!important}
 #hud{display:flex;justify-content:space-between;margin-top:12px;font-size:1.05rem}
 #startBtn{padding:12px 28px;border:none;border-radius:12px;background:#2962ff;color:#fff;font-size:1.1rem;margin-top:22px}
 #timerSel,#levelSel,#modeSel{margin-top:10px;display:flex;gap:6px;justify-content:center;flex-wrap:wrap}
 .btnSel{padding:6px 14px;border:none;border-radius:8px;background:#555;color:#fff;font-size:.85rem;cursor:pointer}
 .sel{background:#00bcd4!important}
 #info{margin-top:10px;min-height:1.4rem;color:#ffb74d;font-weight:bold}
</style>
</head>
<body>
<div id="game">
 <h1>BLAST TRAINER</h1>
 <div id="jp">モード・レベル・時間を選んで START</div>
 
 <!-- モード選択 -->
 <div id="modeSel">
  <button class="btnSel" data-mode="words">単語</button>
  <button class="btnSel" data-mode="phrases">熟語</button>
 </div>
 <!-- レベル選択 -->
 <div id="levelSel">
  <button class="btnSel" data-lv="5">英検5級</button>
  <button class="btnSel" data-lv="4">4級</button>
  <button class="btnSel" data-lv="3">3級</button>
  <button class="btnSel" data-lv="p2">準2</button>
  <button class="btnSel" data-lv="2">2級</button>
  <button class="btnSel" data-lv="p1">準1</button>
  <button class="btnSel" data-lv="1">1級</button>
 </div>
 <!-- タイマー選択 -->
 <div id="timerSel">
  <button class="btnSel" data-sec="60">1分</button>
  <button class="btnSel" data-sec="180">3分</button>
  <button class="btnSel" data-sec="300">5分</button>
  <button class="btnSel" data-sec="600">10分</button>
  <button class="btnSel" data-sec="0">無制限</button>
 </div>
 
 <div id="opts"></div>
 <button id="startBtn">START</button>
 <div id="hud" style="display:none"><span id="timer">∞</span><span id="score">0</span></div>
 <div id="info"></div>
</div>

<script>
/* -------------------- 設定 -------------------- */
const DATA_PATH = "data"; // words-5.json などを置くフォルダ

/* -------- state -------- */
let mode="words", selLv="5", timerMax=0; // 初期設定
let words=[], pool=[], timer=0, score=0, current=null, running=false;

/* -------- DOM refs -------- */
const jpEl=document.getElementById("jp"), optsDiv=document.getElementById("opts"),
      timerEl=document.getElementById("timer"), scoreEl=document.getElementById("score"),
      hud=document.getElementById("hud"), startBtn=document.getElementById("startBtn"), info=document.getElementById("info");

/* -------- ボタン選択ユーティリティ -------- */
function select(btnGroup, value){btnGroup.forEach(b=>b.classList.toggle("sel",b.dataset[btnGroup[0].dataset.mode?"mode":"lv"||"sec"]==value));}

/* モード選択 */
document.querySelectorAll('#modeSel .btnSel').forEach(btn=>btn.onclick=()=>{
  mode=btn.dataset.mode; document.querySelectorAll('#modeSel .btnSel').forEach(b=>b.classList.remove('sel')); btn.classList.add('sel'); jpEl.textContent=`モード: ${mode==='words'? '単語':'熟語'} を選択`;
});
/* レベル選択 */
document.querySelectorAll('#levelSel .btnSel').forEach(btn=>btn.onclick=()=>{
  selLv=btn.dataset.lv; document.querySelectorAll('#levelSel .btnSel').forEach(b=>b.classList.remove('sel')); btn.classList.add('sel'); jpEl.textContent=`レベル: 英検${selLv.replace('p','準')} 選択`;
});
/* タイマー選択 */
document.querySelectorAll('#timerSel .btnSel').forEach(btn=>btn.onclick=()=>{
  timerMax=Number(btn.dataset.sec); document.querySelectorAll('#timerSel .btnSel').forEach(b=>b.classList.remove('sel')); btn.classList.add('sel'); jpEl.textContent=`${timerMax?`制限 ${(timerMax/60)||1} 分`:'無制限'} 選択`;
});

/* ---------- helpers ---------- */
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;};
const speak=txt=>{'speechSynthesis'in window&&speechSynthesis.speak(Object.assign(new SpeechSynthesisUtterance(txt),{lang:'en-US'}));};
function refillPool(){pool=shuffle([...words]);}

/* ---------- fetch data ---------- */
async function loadData(){
  const file=`${DATA_PATH}/${mode}-${selLv}.json`;
  try{
    const res=await fetch(file); words=await res.json();
  }catch(e){ // フォールバック: サンプル少語
    words=[{en:'sample',jp:'サンプル'}];
  }
  refillPool();
}

/* ---------- game logic ---------- */
function nextQuestion(){ if(!running)return; info.textContent=''; optsDiv.innerHTML='';
  if(pool.length===0)refillPool(); current=pool.pop(); jpEl.textContent=current.jp;
  // 選択肢 4 件無重複
  const choices=shuffle([current,...shuffle(words.filter(w=>w.en!==current.en)).slice(0,3)]);
  choices.forEach(c=>{const b=document.createElement('button');b.className='opt';b.textContent=c.en||c.enPhrase;b.onclick=()=>answer(b,c);optsDiv.appendChild(b);}); }
function answer(btn,choice){ if(!running)return; speak(choice.en||choice.enPhrase);
  const ok=(choice.en||choice.enPhrase)===(current.en||current.enPhrase);
  if(ok){btn.classList.add('correct');score++;scoreEl.textContent=score;anime({targets:btn,scale:[1,1.12,1],duration:300});setTimeout(nextQuestion,380);}else{btn.classList.add('wrong');anime({targets:btn,translateX:[0,12,-12,8,-8,0],duration:400});info.textContent=`${choice.en||choice.enPhrase} = ${choice.jp}`;}}

function finish(){ jpEl.textContent='TIME UP!';optsDiv.innerHTML='';startBtn.textContent='RESTART';startBtn.style.display='inline-block';}

async function startGame(){ await loadData(); running=true; score=0; scoreEl.textContent=0; info.textContent=''; timer=timerMax; timerEl.textContent=timerMax?timerMax:'∞'; startBtn.style.display='none'; hud.style.display='flex'; nextQuestion(); if(timerMax){const t=setInterval(()=>{ if(!running){clearInterval(t);return;} timer--; timerEl.textContent=timer; if(timer<=0){running=false; finish(); clearInterval(t);} },1000);} }

startBtn.onclick=startGame;
</script>
</body>
</html>